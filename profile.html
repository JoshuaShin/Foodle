<!DOCTYPE html>
<html>
<head>
    <link rel = "stylesheet" type = "text/css" href = "css/style.css">

    <script src="https://www.gstatic.com/firebasejs/5.9.0/firebase.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="./js/setup_firebase.js"></script>

    <style>
        #frame {
            padding-left: 23.75%; padding-right: 23.75%;
        }
        textarea {
            border-radius: 1px;
            background-color: rgba(45, 45, 45, 0.60);
            padding: 10px;
            outline: none;
            color: whitesmoke;
        }
        p {
            color: whitesmoke;
            text-align: center;
        }
        #scoreBoard {

        }
    </style>
</head>
<body>    
    <div>
        <div id = "searchTop">
            <a id = "foodleLogo" class = "unselectable" href = "./index.html"><h1>FOODLE</h1></a>
        </div>

        <br/>

        <div id = "scoreBoard">

            
        </div> 

        
    <script>

    firebase.auth().onAuthStateChanged(function(user){
        if(user){
            console.log(user.uid)

            var dbref = firebase.database().ref().child("users/" + user.uid);
            dbref.on(
                "value",
                function(snap) {
                    user_info = snap.val();
                    console.log(user_info);
                    displayScore(user_info);
                });
        }
    })


    function displayScore(user_info) {
        document.getElementById("scoreBoard").innerHTML = 
        `
        <p style = "font-size: 24px"><b>History:</b></p><br>
        `

        history_info = user_info["history"];
        for (var key in history_info) {

            document.getElementById("scoreBoard").innerHTML += 
            `
            <div class = "entry">
                <div><p style = "color: whitesmoke;"><b>` + key.split(" ").splice(0, 4).join(" ") + `<b>: ` + history_info[key] + `</p></div>   
            </div>
            <br>
            `
        }

        document.getElementById("scoreBoard").innerHTML += 
        `
        <p style = "font-size: 24px"><b>Your total savings:</b></p><br>
        `

        ingredient_info = user_info["ingredients"];
        for (var key in ingredient_info) {

            document.getElementById("scoreBoard").innerHTML += 
            `
            <div class = "entry">
                <div><p style = "color: whitesmoke;"><b>` + key + `<b>: ` + ingredient_info[key] + `</p></div>   
            </div>
            <br>
            `
        }
    }


    // firebase.auth().signOut() // signout
    </script>


</body>
</html>
