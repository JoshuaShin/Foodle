<!DOCTYPE html>
<html>
<head>
    <link rel = "stylesheet" type = "text/css" href = "css/style.css">

    <script src="https://www.gstatic.com/firebasejs/5.9.0/firebase.js"></script>
<<<<<<< HEAD
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
=======
>>>>>>> 5d7866b75c3edcd9a2df5d2ffdb300304133a8d0
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyBrGlVFqo2ixWMzeeq6ppt4jaMErC8H5LY",
            authDomain: "foodle-d4b88.firebaseapp.com",
            databaseURL: "https://foodle-d4b88.firebaseio.com",
            projectId: "foodle-d4b88",
            storageBucket: "foodle-d4b88.appspot.com",
            messagingSenderId: "506441498159"
        };
        firebase.initializeApp(config);
    </script>

    <style>
        .recipeResult {
            border-radius: 1px;
            background-color: rgba(45, 45, 45, 0.60);
            padding: 1px;
            padding-left: 20px;
        }
        a {
            text-decoration: none;
        }
        #resultHolder {
            padding-left: 23.75%; padding-right: 23.75%;
        }
    </style>
</head>
<body>
    <div>
        <div id = "searchTop">
            <a id = "foodleLogo" class = "unselectable" href = "./index.html"><h1>FOODLE</h1></a>
            <input id = "searchBar" type = "text" placeholder = "#Carrots #Peas #Potatoes #Lunch #Vegan">
            <button id = "searchButton">Q</button>
        </div>
        <div class="dropdown" style="float:right; position: absolute; left: 73.6%">
            <button class="dropbtn">sort</button>
            <div class="dropdown-content" style="right:0;">
                <a onclick="alphabetical()">alphabetical</a>
                <a onclick="alphabetical()">user rating</a>
                <a onclick="alphabetical()">cook time</a>
                <a onclick="alphabetical()">last updated</a>
            </div>
        </div>
        <br/>
        <div id = "resultHolder">
<<<<<<< HEAD
            <div class = "displayresult">
            </div>
=======
>>>>>>> 5d7866b75c3edcd9a2df5d2ffdb300304133a8d0
            <div class = "recipeResult">
                <a href = "./create_recipe.html">
                    <h2 style = "color: whitesmoke;">Add Recipe</h2>    
                </a>
            </div>
            </br>
<<<<<<< HEAD
        </div>
=======
        </div> 
>>>>>>> 5d7866b75c3edcd9a2df5d2ffdb300304133a8d0
    </div>


    <script src="js/search.js"></script>
<<<<<<< HEAD
    <script>    


=======
    <script>
        
>>>>>>> 5d7866b75c3edcd9a2df5d2ffdb300304133a8d0
        // ===== GLOBALS ===== //
        let recipeDatabase = {};
        let searchPharseList = [];
        // ===== GLOBALS ===== //


        // ===== ASYNCHRONOUS TASKS: DATABASE RETRIEVAL & DISPLAY SEARCH RESULT ===== //
        var dbref = firebase.database().ref().child("recipes");
        dbref.on(
            "value",
            function(snap) {
                recipeDatabase = snap.val();
                matchResultToDatabase();
            });
        // ===== ASYNCHRONOUS TASKS: DATABASE RETRIEVAL & DISPLAY SEARCH RESULT ===== //


        // ===== SYNCHRONOUS TASKS ===== //
        searchPharseList = JSON.parse(sessionStorage.getItem("searchPhraseList")); //["chicken", "onion", "pepper", "rice"];
        document.getElementById('searchBar').value = sessionStorage.getItem("searchPhrase");

        Array.prototype.diff = function(arr) {
            return this.filter( function(val) {
                return arr.indexOf(val) < 0;
            });
        };
        // ===== SYNCHRONOUS TASKS ===== //


        // ===== FUNCTIONS ===== //
        function matchResultToDatabase() {
            for(let recipe in recipeDatabase) {
                let ingredients = recipeDatabase[recipe]['ingredients'];
                
                let result = searchPharseList.diff(ingredients);
                if (result.length <= 0) {
                    displayRecipeResultElement(recipeDatabase[recipe]);
                }
            }
        }


        function displayRecipeResultElement(recipeDictionary) {
            document.getElementById("resultHolder").innerHTML = 
            `
            <div class = "recipeResult">
                <a href = "https://www.google.ca/">
                    <h2 style = "color: whitesmoke;"> ` + recipeDictionary['name'] + ` </h2>    
                    <p style = "color: whitesmoke;"> Description: ` + recipeDictionary['description'] + ` </p>
                    <p style = "color: whitesmoke;"> Ingredients: ` + buildIngredientsList(recipeDictionary) + ` </p>
                </a>
            </div>
<<<<<<< HEAD
            ` + document.getElementById("resultHolder").innerHTML;
        }


        function buildIngredientsList(recipeDictionary) {
            return recipeDictionary['ingredients'].join(', ');
        }

        function sortThem(s) {
            Array.prototype.slice.call(document.body.querySelectorAll(s)).sort(function sort (ea, eb) {
                var a = ea.textContent.trim();
                var b = eb.textContent.trim();
                if (a.textContent < b.textContent) return -1;
                if (a.textContent > b.textContent) return 1;
                return 0;
            }).forEach(function(div) {
                div.parentElement.appendChild(div);
            });
        }

        function alphabetical() {
            $('.recipeResult').sort(function(a, b) {
                if (a.textContent < b.textContent) {
                    return -1;
                } else {
                    return 1;
                }
                }).appendTo('.displayresult');
=======
            <br/>
            ` + document.getElementById("resultHolder").innerHTML;
        }


        function buildIngredientsList(recipeDictionary) {
            return recipeDictionary['ingredients'].join(', ');
>>>>>>> 5d7866b75c3edcd9a2df5d2ffdb300304133a8d0
        }
        // ===== FUNCTIONS ===== //

        // ===== FUNCTIONS ===== //



    </script>
</body>
</html>
